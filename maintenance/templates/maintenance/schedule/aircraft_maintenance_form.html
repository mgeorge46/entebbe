{% extends "includes/base.html" %}
{% load crispy_forms_tags %}
{% block greetings %}{% if object %}Edit{% else %}Schedule{% endif %} Aircraft Maintenance{% endblock greetings %}
{% block text %}{% endblock text %}
{% block breadlink1 %}{% endblock breadlink1 %}{% block breadtext1 %}Maintenance{% endblock breadtext1 %}
{% block breadlink2 %}{% endblock breadlink2 %}{% block breadtext2 %}Aircraft{% endblock breadtext2 %}
{% block breadlink3 %}{% endblock breadlink3 %}{% block breadtext3 %}Schedule{% endblock breadtext3 %}
{% block breadlink4 %}{% endblock breadlink4 %}{% block breadtext4 %}{% endblock breadtext4 %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5>{% if object %}Edit Maintenance Schedule{% else %}Schedule New Maintenance{% endif %}</h5>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Please correct the following errors:</strong>
                <ul>
                    {% for field_errors in form.errors.values %}
                        {% for error in field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            </div>
            {% endif %}
            
            {{ form|crispy }}
            
            <div class="mt-3">
                <button type="submit" class="btn btn-success">
                    <i class="fa fa-check"></i> {% if object %}Update Schedule{% else %}Create Schedule{% endif %}
                </button>
                <a href="{% url 'aircraft_maintenance_list' %}" class="btn btn-warning">
                    <i class="fa fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Validation: ensure end_date is after start_date
document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.querySelector('[name="start_date"]');
    const endDateInput = document.querySelector('[name="end_date"]');
    
    if (startDateInput && endDateInput) {
        endDateInput.addEventListener('change', function() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            
            if (endDate <= startDate) {
                alert('End date must be after start date');
                endDateInput.value = '';
            }
        });
    }
});
</script>

{% endblock content %}
